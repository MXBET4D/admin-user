<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - MAXBET4D</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <script>
  const firebaseConfig = {
    apiKey: "AIzaSyDoerH0GZNG9QmCMCRqtmlFBbldKdCDIqw",
    authDomain: "maxbet4d-b8bf0.firebaseapp.com",
    projectId: "maxbet4d-b8bf0",
    storageBucket: "maxbet4d-b8bf0.firebasestorage.app",
    messagingSenderId: "1010739873755",
    appId: "1:1010739873755:web:f63788eafc8237add389fe"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();
  </script>

  <style>
    body { font-family: Arial, sans-serif; background:#0a0f1c; color:white; margin:0; }
    header { background:#111a33; padding:15px; text-align:center; color:#FFD700; font-size:20px; font-weight:bold; }
    .container { padding:15px; }
    .card { background:#1a1a1a; padding:15px; margin:10px 0; border-radius:8px; }
    table { width:100%; border-collapse:collapse; margin-top:10px; font-size:14px; }
    th, td { border:1px solid #444; padding:8px; text-align:left; }
    th { background:#222; }
    button { padding:5px 10px; margin:2px; cursor:pointer; border:none; border-radius:4px; }
    .btn-approve { background:#00cc66; color:white; }
    .btn-reject { background:#ff4444; color:white; }
    .btn-edit { background:#2196F3; color:white; }
    .login-box { max-width:300px; margin:50px auto; background:#111; padding:20px; border-radius:8px; text-align:center; }
    .login-box input { width:90%; padding:8px; margin:6px 0; border-radius:4px; border:none; }
    .login-box button { width:100%; padding:8px; background:#FFD700; border:none; border-radius:4px; font-weight:bold; }
  </style>
</head>
<body>

<header>ðŸ”‘ Admin Panel MAXBET4D</header>

<div id="loginBox" class="login-box">
  <h3>Login Admin</h3>
  <input type="email" id="adminEmail" placeholder="Email Admin">
  <input type="password" id="adminPass" placeholder="Password">
  <button onclick="adminLogin()">Login</button>
</div>

<div id="adminArea" style="display:none;" class="container">

  <h2>ðŸ‘¤ Daftar User</h2>
  <div id="userList"></div>

  <h2>ðŸ’¸ Deposit Request</h2>
  <div id="depositList"></div>

  <h2>ðŸ’° Withdraw Request</h2>
  <div id="withdrawList"></div>

  <button onclick="logout()">Logout</button>
</div>

<script>
function adminLogin(){
  const email = document.getElementById("adminEmail").value;
  const pass = document.getElementById("adminPass").value;
  auth.signInWithEmailAndPassword(email, pass)
    .then(()=> {
      document.getElementById("loginBox").style.display="none";
      document.getElementById("adminArea").style.display="block";
      listenUsers(); listenDeposits(); listenWithdraws();
    })
    .catch(err=>alert("Login gagal: "+err.message));
}

function logout(){
  auth.signOut();
  document.getElementById("adminArea").style.display="none";
  document.getElementById("loginBox").style.display="block";
}

// === LISTENER REALTIME ===
function listenUsers(){
  db.collection("users").onSnapshot(snap=>{
    let html = "<table><tr><th>User</th><th>Saldo</th><th>Bank</th><th>Rekening</th><th>HP</th><th>Aksi</th></tr>";
    snap.forEach(doc=>{
      let d=doc.data();
      html += `<tr>
        <td>${doc.id}</td>
        <td>Rp ${d.balance||0}</td>
        <td>${d.bank||''}</td>
        <td>${d.rekening||''}</td>
        <td>${d.phone||''}</td>
        <td>
          <button class="btn-edit" onclick="editUser('${doc.id}')">Edit</button>
        </td>
      </tr>`;
    });
    html+="</table>";
    document.getElementById("userList").innerHTML=html;
  });
}

function listenDeposits(){
  db.collection("history").where("type","==","Deposit").where("status","==","Pending")
    .onSnapshot(snap=>{
      let html = "<table><tr><th>User</th><th>Nominal</th><th>Status</th><th>Aksi</th></tr>";
      snap.forEach(doc=>{
        let d=doc.data();
        html += `<tr>
          <td>${d.user}</td>
          <td>Rp ${d.amount}</td>
          <td>${d.status}</td>
          <td>
            <button class="btn-approve" onclick="approveDeposit('${doc.id}','${d.user}',${d.amount})">Approve</button>
            <button class="btn-reject" onclick="reject('${doc.id}')">Tolak</button>
          </td>
        </tr>`;
      });
      html+="</table>";
      document.getElementById("depositList").innerHTML=html;
    });
}

function listenWithdraws(){
  db.collection("history").where("type","==","Withdraw").where("status","==","Pending")
    .onSnapshot(snap=>{
      let html = "<table><tr><th>User</th><th>Nominal</th><th>Status</th><th>Aksi</th></tr>";
      snap.forEach(doc=>{
        let d=doc.data();
        html += `<tr>
          <td>${d.user}</td>
          <td>Rp ${d.amount}</td>
          <td>${d.status}</td>
          <td>
            <button class="btn-approve" onclick="approveWithdraw('${doc.id}','${d.user}',${d.amount})">Approve</button>
            <button class="btn-reject" onclick="reject('${doc.id}')">Tolak</button>
          </td>
        </tr>`;
      });
      html+="</table>";
      document.getElementById("withdrawList").innerHTML=html;
    });
}

// === ACTIONS ===
function approveDeposit(docId, user, amount){
  db.collection("users").doc(user).update({
    balance: firebase.firestore.FieldValue.increment(amount)
  });
  db.collection("history").doc(docId).update({status:"Approved"});
}

function approveWithdraw(docId, user, amount){
  db.collection("users").doc(user).update({
    balance: firebase.firestore.FieldValue.increment(-amount)
  });
  db.collection("history").doc(docId).update({status:"Approved"});
}

function reject(docId){
  db.collection("history").doc(docId).update({status:"Rejected"});
}

// === Edit User Manual ===
function editUser(userId){
  db.collection("users").doc(userId).get().then(doc=>{
    let d = doc.data();
    let saldo = prompt("Saldo:", d.balance||0);
    let bank = prompt("Bank:", d.bank||"");
    let rek  = prompt("Rekening:", d.rekening||"");
    let phone = prompt("No HP:", d.phone||"");
    db.collection("users").doc(userId).update({
      balance: parseInt(saldo),
      bank: bank,
      rekening: rek,
      phone: phone
    });
  });
}
</script>
</body>
</html>
