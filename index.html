<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Panel Admin</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background:#0d1117; color:#fff; margin:0; }
    header { background:#161b22; padding:15px; display:flex; justify-content:space-between; align-items:center; }
    h1 { margin:0; font-size:20px; }
    button { background:#f85149; border:none; padding:8px 12px; border-radius:6px; color:white; cursor:pointer; }
    .container { padding:20px; }
    .section { background:#161b22; margin-bottom:20px; padding:15px; border-radius:8px; }
    h2 { margin-top:0; color:#58a6ff; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #30363d; padding:8px; text-align:left; }
    th { background:#21262d; }
    tr:nth-child(even) { background:#161b22; }
    tr:nth-child(odd) { background:#0d1117; }
    input, select {
      background:#0d1117; color:#fff; border:1px solid #30363d;
      padding:5px; border-radius:4px; width:100%;
    }
    .actions button { margin-right:5px; background:#238636; }
    .actions .delete { background:#f85149; }
  </style>
</head>
<body>
  <header>
    <h1>ðŸ”¥ Admin Panel</h1>
    <button onclick="logout()">Logout</button>
  </header>

  <div class="container">
    <!-- Deposit -->
    <div class="section">
      <h2>Deposit Requests</h2>
      <table id="depositTable">
        <thead>
          <tr>
            <th>User</th><th>Amount</th><th>Status</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Withdraw -->
    <div class="section">
      <h2>Withdraw Requests</h2>
      <table id="withdrawTable">
        <thead>
          <tr>
            <th>User</th><th>Amount</th><th>Status</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Data Rekening -->
    <div class="section">
      <h2>Data Rekening User</h2>
      <table id="userTable">
        <thead>
          <tr>
            <th>User</th><th>Nama</th><th>Rekening</th><th>Bank</th><th>Balance</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // --- Firebase Config ---
    const firebaseConfig = {
      apiKey: "AIzaSyDoerH0GZNG9QmCMCRqtmlFBbldKdCDIqw",
      authDomain: "maxbet4d-b8bf0.firebaseapp.com",
      projectId: "maxbet4d-b8bf0",
      storageBucket: "maxbet4d-b8bf0.appspot.com",
      messagingSenderId: "1010739873755",
      appId: "1:1010739873755:web:f63788eafc8237add389fe"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const adminEmails = ["admin@gmail.com"]; // daftar email admin

    // --- Auth Check ---
    auth.onAuthStateChanged(user => {
      if (user && adminEmails.includes(user.email)) {
        loadDeposits();
        loadWithdraws();
        loadUsers();
      } else {
        window.location.href = "admin-login.html";
      }
    });

    function logout() {
      auth.signOut().then(() => window.location.href="admin-login.html");
    }

    // --- Load Deposit Requests ---
    function loadDeposits() {
      db.collection("history").where("type","==","Deposit")
        .onSnapshot(snap => {
          const tbody = document.querySelector("#depositTable tbody");
          tbody.innerHTML = "";
          snap.forEach(doc => {
            const d = doc.data();
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${d.user}</td>
              <td>Rp ${d.amount}</td>
              <td>${d.status}</td>
              <td class="actions">
                <button onclick="updateStatus('${doc.id}','Deposit','Approved')">âœ”</button>
                <button class="delete" onclick="updateStatus('${doc.id}','Deposit','Rejected')">âœ–</button>
              </td>`;
            tbody.appendChild(tr);
          });
        });
    }

    // --- Load Withdraw Requests ---
    function loadWithdraws() {
      db.collection("history").where("type","==","Withdraw")
        .onSnapshot(snap => {
          const tbody = document.querySelector("#withdrawTable tbody");
          tbody.innerHTML = "";
          snap.forEach(doc => {
            const d = doc.data();
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${d.user}</td>
              <td>Rp ${d.amount}</td>
              <td>${d.status}</td>
              <td class="actions">
                <button onclick="updateStatus('${doc.id}','Withdraw','Approved')">âœ”</button>
                <button class="delete" onclick="updateStatus('${doc.id}','Withdraw','Rejected')">âœ–</button>
              </td>`;
            tbody.appendChild(tr);
          });
        });
    }

    // --- Update Status (Deposit/Withdraw) ---
    function updateStatus(id,type,status) {
      db.collection("history").doc(id).update({status:status})
        .then(()=>alert(type+" "+status));
    }

    // --- Load Users ---
    function loadUsers() {
      db.collection("users").onSnapshot(snap => {
        const tbody = document.querySelector("#userTable tbody");
        tbody.innerHTML = "";
        snap.forEach(doc => {
          const u = doc.data();
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${doc.id}</td>
            <td>${u.nama}</td>
            <td>${u.rekening}</td>
            <td>${u.bank}</td>
            <td>Rp ${u.balance}</td>
            <td class="actions">
              <button onclick="editBalance('${doc.id}',${u.balance})">ðŸ’°</button>
            </td>`;
          tbody.appendChild(tr);
        });
      });
    }

    // --- Edit Balance User ---
    function editBalance(uid,current) {
      const newBal = prompt("Saldo baru untuk "+uid, current);
      if(newBal !== null) {
        db.collection("users").doc(uid).update({balance:parseInt(newBal)});
      }
    }
  </script>
</body>
</html>
